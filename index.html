<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>每日摄入计算器 · iPhone版（高级训练者）</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <style>
    :root{--brand:#2563eb;--bg:#f6f7fb;--text:#111827;--muted:#6b7280}
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e5e7eb;padding:12px 16px}
    header h1{margin:0;font-size:18px}
    main{max-width:900px;margin:16px auto;padding:0 12px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin-bottom:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>div{flex:1 1 150px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font-size:16px}
    button{padding:10px 14px;border:none;border-radius:10px;background:var(--brand);color:#fff;font-size:16px;cursor:pointer}
    button.ghost{background:#fff;color:#111;border:1px solid #d1d5db}
    .kpi{display:flex;gap:10px;flex-wrap:wrap}
    .kpi .box{flex:1 1 150px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
    .box h4{margin:0 0 6px;font-size:12px;color:var(--muted)}
    .box div{font-size:18px;font-weight:600}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px}
    .ok{background:#ecfdf5;color:#065f46}
    .warn{background:#fff7ed;color:#9a3412}
    .bad{background:#fef2f2;color:#7f1d1d}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
    .muted{color:var(--muted);font-size:12px}
    footer{color:var(--muted);font-size:12px;text-align:center;margin:20px 0}
  </style>
</head>
<body>
<header><h1>每日摄入计算器 · iPhone版（高级训练者）</h1></header>
<main>
  <section class="card">
    <h2 style="margin:0 0 8px">目标（高级训练者估算）</h2>
    <div class="row">
      <div><label>当前体重 (kg)</label><input id="cur_weight" type="number" step="0.1" placeholder="如 86" oninput="recalcTargets()"></div>
      <div><label>总热量 (kcal)</label><input id="target_kcal" type="number" step="10" value="2500" oninput="manualTargets()"></div>
      <div><label>蛋白质目标 (g)</label><input id="target_prot" type="number" step="1" value="180" oninput="manualTargets()"></div>
      <div><label>碳水目标 (g)</label><input id="target_carb" type="number" step="1" value="267" oninput="manualTargets()"></div>
      <div><label>脂肪目标 (g)</label><input id="target_fat" type="number" step="1" value="79" oninput="manualTargets()"></div>
    </div>
    <p class="muted">公式（减脂）：<br>
    <b>kcal ≈ 31 × 体重(kg)</b>（高训练量人群≈维持的85%左右）；<b>蛋白 ≈ 2.2 g/kg</b>；
    剩余热量按<b>碳水:脂肪=60:40</b>分配。你也可以手动修改目标。</p>
  </section>

  <section class="card">
    <h2 style="margin:0 0 8px">今天已吃</h2>
    <div class="row">
      <div><label>熟白米饭 (g)</label><input id="eat_rice" type="number" step="1"></div>
      <div><label>熟意面 (g)</label><input id="eat_pasta" type="number" step="1"></div>
      <div><label>熟糙米 (g)</label><input id="eat_brown" type="number" step="1"></div>
      <div><label>熟番薯 (g)</label><input id="eat_sweet" type="number" step="1"></div>
    </div>
    <div class="row" style="margin-top:8px">
      <div><label>带骨熟鸡腿 (g)</label><input id="eat_leg" type="number" step="1"></div>
      <div><label>熟鸡胸肉 (g)</label><input id="eat_breast" type="number" step="1"></div>
      <div><label>熟三文鱼 (g)</label><input id="eat_salmon" type="number" step="1"></div>
      <div><label>熟牛肉 (g)</label><input id="eat_beef" type="number" step="1"></div>
      <div><label>熟鱼肉（白肉）(g)</label><input id="eat_fish" type="number" step="1"></div>
      <div><label>全蛋 (个)</label><input id="eat_eggs" type="number" step="1"></div>
    </div>
    <div class="row" style="margin-top:12px">
      <button onclick="calc()">计算</button>
      <button class="ghost" onclick="resetAll()">清空</button>
    </div>
  </section>

  <section class="card">
    <h2 style="margin:0 0 8px">已吃与剩余</h2>
    <div class="kpi">
      <div class="box"><h4>已吃碳水</h4><div id="c_carb">—</div></div>
      <div class="box"><h4>已吃蛋白</h4><div id="c_prot">—</div></div>
      <div class="box"><h4>已吃脂肪</h4><div id="c_fat">—</div></div>
    </div>
    <div class="kpi" style="margin-top:8px">
      <div class="box"><h4>剩余碳水</h4><div id="r_carb">—</div></div>
      <div class="box"><h4>剩余蛋白</h4><div id="r_prot">—</div></div>
      <div class="box"><h4>剩余脂肪</h4><div id="r_fat">—</div></div>
    </div>
    <p id="status" style="margin-top:8px"></p>
  </section>

  <section class="card">
    <h2 style="margin:0 0 8px">建议补充</h2>
    <table>
      <thead><tr><th>项目</th><th>建议量</th><th>说明</th></tr></thead>
      <tbody>
        <tr><td>熟白米饭（或下列替代）</td><td id="a_rice">—</td><td>100 g ≈ 28C / 2P / 0.3F</td></tr>
        <tr><td>熟意面（替代）</td><td id="a_pasta">—</td><td>100 g ≈ 25C / 5P / 1.1F</td></tr>
        <tr><td>熟糙米（替代）</td><td id="a_brown">—</td><td>100 g ≈ 23C / 2.6P / 1F</td></tr>
        <tr><td>熟番薯（替代）</td><td id="a_sweet">—</td><td>100 g ≈ 20C / 1.6P / 0.1F</td></tr>
        <tr><td>熟鸡胸肉</td><td id="a_breast">—</td><td>100 g ≈ 31P / 3F</td></tr>
        <tr><td>熟鱼肉（白肉）</td><td id="a_fish">—</td><td>100 g ≈ 23P / 1F</td></tr>
        <tr><td>橄榄油</td><td id="a_oil">—</td><td>1 g ≈ 1F（补剩余脂肪）</td></tr>
      </tbody>
    </table>
    <p class="muted">默认：米饭/意面/糙米/番薯补碳水；鸡胸/白鱼补蛋白；鸡胸或鱼自带的脂肪会自动计入，剩余脂肪由橄榄油补齐。</p>
  </section>

  <footer>© 2025 iPhone版 · 高级训练者公式：kcal≈31×kg，蛋白≈2.2g/kg，其余60:40分给碳水/脂肪（可手动改）。</footer>
</main>

<script>
// 营养表（每100g熟重；鸡蛋按1个）
const N = {
  rice:   { carb:28,  prot:2,   fat:0.3 },
  pasta:  { carb:25,  prot:5,   fat:1.1 },
  brown:  { carb:23,  prot:2.6, fat:1 },
  sweet:  { carb:20,  prot:1.6, fat:0.1 },
  leg:    { carb:0,   prot:20,  fat:8 },
  breast: { carb:0,   prot:31,  fat:3 },
  salmon: { carb:0,   prot:22,  fat:12 },
  beef:   { carb:0,   prot:26,  fat:10 },
  fish:   { carb:0,   prot:23,  fat:1 },
  egg:    { carb:0.5, prot:6,   fat:5 } // per egg
};

function recalcTargets(){
  const w = parseFloat(document.getElementById('cur_weight').value);
  if(!w || w<=0) return;
  // 高级训练者减脂：kcal ≈ 31 × kg；蛋白 ≈ 2.2 × kg；剩余60:40分到C/F
  const kcal = Math.round(w * 31);
  const prot = Math.round(w * 2.2);
  const prot_kcal = prot * 4;
  const rest = Math.max(0, kcal - prot_kcal);
  const carb = Math.round((rest * 0.6) / 4);
  const fat  = Math.round((rest * 0.4) / 9);
  setTargets({kcal,prot,carb,fat});
}
function manualTargets(){
  const kcal = parseFloat(document.getElementById('target_kcal').value)||0;
  const prot = parseFloat(document.getElementById('target_prot').value)||0;
  const carb = parseFloat(document.getElementById('target_carb').value)||0;
  const fat  = parseFloat(document.getElementById('target_fat').value)||0;
  setTargets({kcal,prot,carb,fat});
}
function setTargets(t){
  document.getElementById('target_kcal').value = Math.round(t.kcal||0);
  document.getElementById('target_prot').value = Math.round(t.prot||0);
  document.getElementById('target_carb').value = Math.round(t.carb||0);
  document.getElementById('target_fat').value  = Math.round(t.fat||0);
}
function getTargets(){
  return {
    kcal: parseFloat(document.getElementById('target_kcal').value)||0,
    prot: parseFloat(document.getElementById('target_prot').value)||0,
    carb: parseFloat(document.getElementById('target_carb').value)||0,
    fat : parseFloat(document.getElementById('target_fat').value)||0
  };
}
function val(id){ const v = parseFloat(document.getElementById(id).value); return isNaN(v)?0:v; }

function calc(){
  const t = getTargets();
  const eat = {
    rice: val('eat_rice'), pasta: val('eat_pasta'), brown: val('eat_brown'), sweet: val('eat_sweet'),
    leg: val('eat_leg'), breast: val('eat_breast'), salmon: val('eat_salmon'), beef: val('eat_beef'), fish: val('eat_fish'),
    eggs: val('eat_eggs')
  };
  const eaten = { carb:0, prot:0, fat:0 };
  // carb
  eaten.carb += eat.rice*N.rice.carb/100 + eat.pasta*N.pasta.carb/100 + eat.brown*N.brown.carb/100 + eat.sweet*N.sweet.carb/100 + eat.eggs*N.egg.carb;
  // protein
  eaten.prot += eat.rice*N.rice.prot/100 + eat.pasta*N.pasta.prot/100 + eat.brown*N.brown.prot/100 + eat.sweet*N.sweet.prot/100;
  eaten.prot += eat.leg*N.leg.prot/100 + eat.breast*N.breast.prot/100 + eat.salmon*N.salmon.prot/100 + eat.beef*N.beef.prot/100 + eat.fish*N.fish.prot/100 + eat.eggs*N.egg.prot;
  // fat
  eaten.fat  += eat.rice*N.rice.fat/100  + eat.pasta*N.pasta.fat/100  + eat.brown*N.brown.fat/100  + eat.sweet*N.sweet.fat/100;
  eaten.fat  += eat.leg*N.leg.fat/100  + eat.breast*N.breast.fat/100  + eat.salmon*N.salmon.fat/100  + eat.beef*N.beef.fat/100  + eat.fish*N.fish.fat/100  + eat.eggs*N.egg.fat;

  const remain = {
    carb: Math.max(0, t.carb - eaten.carb),
    prot: Math.max(0, t.prot - eaten.prot),
    fat : Math.max(0, t.fat  - eaten.fat)
  };

  // KPIs
  document.getElementById('c_carb').textContent = eaten.carb.toFixed(1)+' g';
  document.getElementById('c_prot').textContent = eaten.prot.toFixed(1)+' g';
  document.getElementById('c_fat').textContent  = eaten.fat.toFixed(1)+' g';
  document.getElementById('r_carb').textContent = remain.carb.toFixed(1)+' g';
  document.getElementById('r_prot').textContent = remain.prot.toFixed(1)+' g';
  document.getElementById('r_fat').textContent  = remain.fat.toFixed(1)+' g';

  // 建议补充（等效，默认：鸡胸+白鱼+米饭；油补剩余脂肪）
  const add_rice   = remain.carb / N.rice.carb * 100;
  const add_pasta  = remain.carb / N.pasta.carb * 100;
  const add_brown  = remain.carb / N.brown.carb * 100;
  const add_sweet  = remain.carb / N.sweet.carb * 100;
  const add_breast = remain.prot / N.breast.prot * 100;
  const add_fish   = remain.prot / N.fish.prot * 100;
  const fat_from_breast = add_breast * N.breast.fat/100;
  let add_oil = Math.max(0, remain.fat - fat_from_breast);

  document.getElementById('a_rice').textContent   = isFinite(add_rice)?Math.round(add_rice)+' g':'—';
  document.getElementById('a_pasta').textContent  = isFinite(add_pasta)?Math.round(add_pasta)+' g':'—';
  document.getElementById('a_brown').textContent  = isFinite(add_brown)?Math.round(add_brown)+' g':'—';
  document.getElementById('a_sweet').textContent  = isFinite(add_sweet)?Math.round(add_sweet)+' g':'—';
  document.getElementById('a_breast').textContent = isFinite(add_breast)?Math.round(add_breast)+' g':'—';
  document.getElementById('a_fish').textContent   = isFinite(add_fish)?Math.round(add_fish)+' g':'—';
  document.getElementById('a_oil').textContent    = isFinite(add_oil)?Math.round(add_oil)+' g':'—';

  // 提示
  let badge='ok', msg='数据正常，继续补齐剩余目标即可。';
  if (remain.carb===0 && remain.prot===0 && remain.fat===0) msg='今天目标已达成！';
  document.getElementById('status').innerHTML = `<span class="pill ${badge}">${msg}</span>`;
}

// 默认把目标写入输入框
(function init(){ document.getElementById('target_kcal').value=2500; document.getElementById('target_prot').value=180; document.getElementById('target_carb').value=267; document.getElementById('target_fat').value=79; })();

function resetAll(){
  ['eat_rice','eat_pasta','eat_brown','eat_sweet','eat_leg','eat_breast','eat_salmon','eat_beef','eat_fish','eat_eggs'].forEach(id=> document.getElementById(id).value='');
  ['c_carb','c_prot','c_fat','r_carb','r_prot','r_fat','a_rice','a_pasta','a_brown','a_sweet','a_breast','a_fish','a_oil'].forEach(id=> document.getElementById(id).textContent='—');
  document.getElementById('status').innerHTML='';
}
</script>
</body>
</html>
